<?php

namespace Database\Seeders;

use App\Models\InformasiIndikator;
use App\Models\EvaluasiTahun;
use Illuminate\Database\Seeder;
use Illuminate\Support\Facades\DB;

class InformasiIndikatorSeeder extends Seeder
{
    public function run()
    {
        DB::statement('SET FOREIGN_KEY_CHECKS=0;');
        InformasiIndikator::truncate();
        DB::statement('SET FOREIGN_KEY_CHECKS=1;');

        // Create or get evaluation years
        $tahun2023 = EvaluasiTahun::firstOrCreate(
            ['tahun' => 2023],
            ['indeks_akumulasi' => 0]
        )->tahun;

        $tahun2024 = EvaluasiTahun::firstOrCreate(
            ['tahun' => 2024],
            ['indeks_akumulasi' => 0]
        )->tahun;

        // Data manual untuk 47 indikator (2 tahun)
        $dataIndikator = [
            // Format: [tahun, indikator_id, user_id (dinas), indeks, jumlah_dokumen, is_updated]
            
            // Tahun 2023
            [2023, 1, 3, 82.5, 2, 1],   // Indikator 1 - Dinas Kominfo
            [2023, 2, 3, 80.0, 3, 1],
            [2023, 3, 3, 75.0, 4, 1],   // Indikator 3 - Dinas Setdako
            [2023, 4, 3, 80.0, 3, 1],
            [2023, 5, 3, 80.0, 3, 1],
            [2023, 6, 3, 80.0, 3, 1],
            [2023, 7, 3, 80.0, 3, 1],
            [2023, 8, 3, 80.0, 3, 1],
            [2023, 9, 3, 80.0, 3, 1],
            [2023, 10, 3, 80.0, 3, 1],

            [2023, 11, 3, 80.0, 3, 1],
            [2023, 12, 3, 80.0, 3, 1],

            [2023, 11, 4, 80.0, 3, 1],
            [2023, 12, 4, 80.0, 3, 1],
            [2023, 13, 3, 80.0, 3, 1],
            [2023, 14, 4, 80.0, 3, 1],
            [2023, 15, 3, 80.0, 3, 1],
            [2023, 16, 3, 80.0, 3, 1],
            [2023, 17, 3, 80.0, 3, 1],
            [2023, 18, 3, 80.0, 3, 1],

            [2023, 19, 3, 80.0, 3, 1],
            [2023, 19, 4, 80.0, 3, 1],

            [2023, 20, 4, 80.0, 3, 1],
            [2023, 21, 5, 80.0, 3, 1],
            [2023, 22, 3, 80.0, 3, 1],
            [2023, 23, 3, 80.0, 3, 1],
            [2023, 24, 4, 80.0, 3, 1],
            [2023, 25, 6, 80.0, 3, 1],
            [2023, 26, 6, 80.0, 3, 1],
            [2023, 27, 3, 80.0, 3, 1],
            [2023, 28, 3, 80.0, 3, 1],

            [2023, 29, 3, 80.0, 3, 1], 
            [2023, 29, 5, 80.0, 3, 1],

            [2023, 30, 3, 80.0, 3, 1],
            [2023, 30, 5, 80.0, 3, 1],

            [2023, 31, 3, 80.0, 3, 1],
            [2023, 31, 5, 80.0, 3, 1],

            [2023, 32, 7, 80.0, 3, 1],

            [2023, 33, 7, 80.0, 3, 1],
            [2023, 33, 8, 80.0, 3, 1],

            [2023, 34, 7, 80.0, 3, 1],
            [2023, 34, 8, 80.0, 3, 1],

            [2023, 35, 4, 80.0, 3, 1],
            [2023, 36, 6, 80.0, 3, 1],
            [2023, 37, 9, 80.0, 3, 1],
            [2023, 38, 4, 80.0, 3, 1],
            [2023, 39, 5, 80.0, 3, 1],
            [2023, 40, 4, 80.0, 3, 1],
            [2023, 41, 6, 80.0, 3, 1],
            [2023, 42, 3, 80.0, 3, 1],
            [2023, 43, 3, 80.0, 3, 1],
            [2023, 44, 4, 80.0, 3, 1],
            [2023, 45, 10, 80.0, 3, 1],
            [2023, 46, 11, 80.0, 3, 1],
            [2023, 47, 12, 80.0, 3, 1],
            [2023, 47, 13, 80.0, 3, 1],
            [2023, 47, 7, 80.0, 3, 1],
            [2023, 47, 3, 80.0, 3, 1],
            
            // Tahun 2024 (biasanya menunjukkan peningkatan)
            [2024, 1, 3, 82.5, 2, 1],   // Indikator 1 - Dinas Kominfo
            [2024, 2, 3, 80.0, 3, 1],
            [2024, 3, 3, 75.0, 4, 1],   // Indikator 3 - Dinas Setdako
            [2024, 4, 3, 80.0, 3, 1],
            [2024, 5, 3, 80.0, 3, 1],
            [2024, 6, 3, 80.0, 3, 1],
            [2024, 7, 3, 80.0, 3, 1],
            [2024, 8, 3, 80.0, 3, 1],
            [2024, 9, 3, 80.0, 3, 1],
            [2024, 10, 3, 80.0, 3, 1],
            
            [2024, 11, 3, 80.0, 3, 1],
            [2024, 12, 3, 80.0, 3, 1],

            [2024, 11, 4, 80.0, 3, 1],
            [2024, 12, 4, 80.0, 3, 1],
            [2024, 13, 3, 80.0, 3, 1],
            [2024, 14, 4, 80.0, 3, 1],
            [2024, 15, 3, 80.0, 3, 1],
            [2024, 16, 3, 80.0, 3, 1],
            [2024, 17, 3, 80.0, 3, 1],
            [2024, 18, 3, 80.0, 3, 1],

            [2024, 19, 3, 80.0, 3, 1],
            [2024, 19, 4, 80.0, 3, 1],

            [2024, 20, 4, 80.0, 3, 1],
            [2024, 21, 5, 80.0, 3, 1],
            [2024, 22, 3, 80.0, 3, 1],
            [2024, 23, 3, 80.0, 3, 1],
            [2024, 24, 4, 80.0, 3, 1],
            [2024, 25, 6, 80.0, 3, 1],
            [2024, 26, 6, 80.0, 3, 1],
            [2024, 27, 3, 80.0, 3, 1],
            [2024, 28, 3, 80.0, 3, 1],

            [2024, 29, 3, 80.0, 3, 1], 
            [2024, 29, 5, 80.0, 3, 1],

            [2024, 30, 3, 80.0, 3, 1],
            [2024, 30, 5, 80.0, 3, 1],

            [2024, 31, 3, 80.0, 3, 1],
            [2024, 31, 5, 80.0, 3, 1],

            [2024, 32, 7, 80.0, 3, 1],

            [2024, 33, 7, 80.0, 3, 1],
            [2024, 33, 8, 80.0, 3, 1],

            [2024, 34, 7, 80.0, 3, 1],
            [2024, 34, 8, 80.0, 3, 1],

            [2024, 35, 4, 80.0, 3, 1],
            [2024, 36, 6, 80.0, 3, 1],
            [2024, 37, 9, 80.0, 3, 1],
            [2024, 38, 4, 80.0, 3, 1],
            [2024, 39, 5, 80.0, 3, 1],
            [2024, 40, 4, 80.0, 3, 1],
            [2024, 41, 6, 80.0, 3, 1],
            [2024, 42, 3, 80.0, 3, 1],
            [2024, 43, 3, 80.0, 3, 1],
            [2024, 44, 4, 80.0, 3, 1],
            [2024, 45, 10, 80.0, 3, 1],
            [2024, 46, 11, 80.0, 3, 1],
            [2024, 47, 12, 80.0, 3, 1],
            [2024, 47, 13, 80.0, 3, 1],
            [2024, 47, 7, 80.0, 3, 1],
            [2024, 47, 3, 80.0, 3, 1],
        ];

        foreach ($dataIndikator as $data) {
            InformasiIndikator::create([
                'tahun' => $data[0],
                'indikator_id' => $data[1],
                'user_id' => $data[2],
                'indeks' => $data[3],
                'jumlah_dokumen' => $data[4],
                'is_updated' => $data[5],
                'created_at' => now(),
                'updated_at' => now()
            ]);
        }

        $this->command->info('Seeder InformasiIndikator berhasil dijalankan!');
        $this->command->info('Total data: '.count($dataIndikator).' (47 indikator Ã— 2 tahun)');
        
        // Show sample data
        $this->command->table(
            ['Tahun', 'Indikator ID', 'Dinas', 'Indeks', 'Dokumen'],
            InformasiIndikator::with(['indikator', 'user'])
                ->orderBy('tahun')
                ->orderBy('indikator_id')
                ->limit(10)
                ->get()
                ->map(function ($item) {
                    return [
                        'Tahun' => $item->tahun,
                        'Indikator ID' => $item->indikator_id,
                        'Dinas' => $item->user->nama_dinas ?? 'Unknown',
                        'Indeks' => $item->indeks,
                        'Dokumen' => $item->jumlah_dokumen
                    ];
                })->toArray()
        );
    }
}